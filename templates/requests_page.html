{% extends "base.html" %}{% set active='requests' %}
{% block content %}
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
  <!-- Formulario: Crear Requerimiento -->
  <section class="bg-white rounded-2xl shadow p-4">
    <h2 class="font-semibold mb-3">Crear Requerimiento</h2>
    <form
      hx-post="/ui/create_request"
      hx-target="#requestsTable"
      hx-swap="outerHTML"
      class="space-y-3"
    >
      <label class="text-sm font-medium">Título</label>
      <input name="title" required placeholder="Título" class="w-full border rounded px-3 py-2" />

      <label class="text-sm font-medium">Descripción</label>
      <textarea name="description" placeholder="Descripción" class="w-full border rounded px-3 py-2"></textarea>

      <label class="text-sm font-medium">Unidad</label>
      <select name="unit_id" class="border rounded px-2 py-2 w-full" required>
        <option value="">Selecciona unidad</option>
        {% for u in units %}<option value="{{u.id}}">{{u.name}}</option>{% endfor %}
      </select>

      <label class="text-sm font-medium">Prioridad (complejidad)</label>
      <select name="complexity" class="border rounded px-2 py-2 w-full">
        <option value="1">Baja</option>
        <option value="2" selected>Media</option>
        <option value="3">Alta</option>
      </select>

      <label class="text-sm font-medium">Fecha de vencimiento</label>
      <input name="due_date" type="date" class="w-full border rounded px-3 py-2" />

      <button
        class="bg-blue-600 text-white px-3 py-2 rounded"
        hx-on::after-request="
          htmx.ajax('GET','/ui/partials/requests',{target:'#requestsTable',swap:'outerHTML'});
          htmx.ajax('GET','/ui/partials/priorities',{target:'#prioritiesTable',swap:'outerHTML'});
          htmx.ajax('GET','/ui/partials/assign_form',{target:'#assignForm',swap:'outerHTML'});
        "
      >
        Guardar
      </button>
    </form>
  </section>

  <!-- Listas + Asignación + Prioridades -->
  <section class="bg-white rounded-2xl shadow p-4 lg:col-span-2">
    <div class="flex items-center justify-between mb-2">
      <h2 class="font-semibold">Requerimientos</h2>
      <button class="text-sm text-blue-600" hx-get="/ui/partials/requests" hx-target="#requestsTable" hx-swap="outerHTML">Refrescar</button>
    </div>
    {% include "partials/requests.html" %}

    <hr class="my-4"/>

    {% include "partials/assign_form.html" %}

    <div class="flex items-center justify-between mt-6 mb-2">
      <h2 class="font-semibold">Prioridades</h2>
      <button class="text-sm text-blue-600" hx-get="/ui/partials/priorities" hx-target="#prioritiesTable" hx-swap="outerHTML">Refrescar</button>
    </div>
    {% include "partials/priorities.html" %}
  </section>
</div>
{% endblock %}
