{% extends "base.html" %}
{% block content %}

<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
  <!-- Col 1: Formularios -->
  <section class="bg-white rounded-2xl shadow p-4">
    <h2 class="font-semibold mb-3">Crear Usuario</h2>
    <form hx-post="/ui/create_user" hx-target="#usersTable" hx-swap="outerHTML" class="space-y-2">
      <input name="full_name" required placeholder="Nombre completo" class="w-full border rounded px-3 py-2" />
      <input name="role" required placeholder="Rol (p.ej. Asesor Jurídico)" class="w-full border rounded px-3 py-2" />
      <button class="bg-blue-600 text-white px-3 py-2 rounded">Guardar</button>
    </form>

    <hr class="my-4"/>

    <h2 class="font-semibold mb-3">Crear Unidad</h2>
    <form hx-post="/ui/create_unit" hx-target="#unitsTable" hx-swap="outerHTML" class="space-y-2">
      <input name="name" required placeholder="Nombre unidad" class="w-full border rounded px-3 py-2" />
      <button class="bg-blue-600 text-white px-3 py-2 rounded">Guardar</button>
    </form>

    <hr class="my-4"/>

    <h2 class="font-semibold mb-3">Crear Requerimiento</h2>
    <form hx-post="/ui/create_request" hx-target="#requestsTable" hx-swap="outerHTML" class="space-y-2">
      <input name="title" required placeholder="Título" class="w-full border rounded px-3 py-2" />
      <textarea name="description" placeholder="Descripción" class="w-full border rounded px-3 py-2"></textarea>
      <div class="flex gap-2">
        <select name="unit_id" class="border rounded px-2 py-2 flex-1" required>
          <option value="">Unidad</option>
          {% for u in units %}<option value="{{u.id}}">{{u.name}}</option>{% endfor %}
        </select>
        <select name="complexity" class="border rounded px-2 py-2">
          <option value="1">Baja</option>
          <option value="2" selected>Media</option>
          <option value="3">Alta</option>
        </select>
      </div>
      <input name="due_date" type="date" class="w-full border rounded px-3 py-2" />
      <button class="bg-blue-600 text-white px-3 py-2 rounded"
              hx-on::after-request="htmx.ajax('GET','/ui/partials/priorities',{target:'#prioritiesTable',swap:'outerHTML'})">
        Guardar
      </button>
    </form>
  </section>

  <!-- Col 2: Listados -->
  <section class="bg-white rounded-2xl shadow p-4">
    <div class="flex items-center justify-between mb-2">
      <h2 class="font-semibold">Usuarios</h2>
      <button class="text-sm text-blue-600" hx-get="/ui/partials/users" hx-target="#usersTable" hx-swap="outerHTML">Refrescar</button>
    </div>
    {% include "partials/users.html" %}

    <hr class="my-4"/>

    <div class="flex items-center justify-between mb-2">
      <h2 class="font-semibold">Unidades</h2>
      <button class="text-sm text-blue-600" hx-get="/ui/partials/units" hx-target="#unitsTable" hx-swap="outerHTML">Refrescar</button>
    </div>
    {% include "partials/units.html" %}

    <hr class="my-4"/>

    <div class="flex items-center justify-between mb-2">
      <h2 class="font-semibold">Requerimientos</h2>
      <button class="text-sm text-blue-600" hx-get="/ui/partials/requests" hx-target="#requestsTable" hx-swap="outerHTML">Refrescar</button>
    </div>
    {% include "partials/requests.html" %}
  </section>

  <!-- Col 3: Prioridades + Asignación -->
  <section class="bg-white rounded-2xl shadow p-4">
    <div class="flex items-center justify-between mb-2">
      <h2 class="font-semibold">Prioridades</h2>
      <button class="text-sm text-blue-600" hx-get="/ui/partials/priorities" hx-target="#prioritiesTable" hx-swap="outerHTML">Refrescar</button>
    </div>
    {% include "partials/priorities.html" %}

    <hr class="my-4"/>

    <h2 class="font-semibold mb-3">Asignar requerimiento</h2>
    <form hx-post="/ui/assign" hx-target="#prioritiesTable" hx-swap="outerHTML" class="space-y-2">
      <div class="flex gap-2">
        <select name="request_id" class="border rounded px-2 py-2 flex-1" required>
          <option value="">Requerimiento</option>
          {% for r in requests %}<option value="{{r.id}}">#{{r.id}} - {{r.title | truncate(40, True)}}</option>{% endfor %}
        </select>
        <select name="user_id" class="border rounded px-2 py-2 flex-1" required>
          <option value="">Usuario</option>
          {% for u in users %}<option value="{{u.id}}">{{u.full_name}}</option>{% endfor %}
        </select>
      </div>
      <button class="bg-blue-600 text-white px-3 py-2 rounded">Asignar</button>
    </form>
  </section>
</div>

{% endblock %}
