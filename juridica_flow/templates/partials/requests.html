<table id="requestsTable" class="w-full text-sm">
  <thead>
    <tr class="border-b">
      <th class="text-left py-2 px-2">#</th>
      <th class="text-left px-2">TÃ­tulo</th>
      <th class="text-left px-2">Unidad</th>
      <th class="text-left px-2">Prior.</th>
      <th class="text-left px-2">Vence</th>
      <th class="text-left px-2">Estado</th>
    </tr>
  </thead>
  <tbody>
  {% for r in requests %}
    <tr class="border-b hover:bg-gray-50" title="{{ r.description }}">
      <td class="py-2 px-2">#{{r.id}}</td>
      <td class="px-2">{{r.title}}</td>
      <td class="px-2">{{r.unit.name if r.unit else '-'}}</td>
      <td class="px-2">{{r.complexity}}</td>
      <td class="px-2">{{r.due_date or '-'}}</td>
      <td class="px-2">
        {% set assigned = r.assignments|length > 0 %}
        {% if not assigned %}
          <!-- Sin asignados: mostrar badge y no permitir cambios -->
          <span class="inline-block text-xs px-2 py-1 rounded bg-gray-100 text-gray-700">SIN ASIGNAR</span>
        {% else %}
          <!-- Con asignados: permitir cambiar entre PENDIENTE / COMPLETADO -->
          <form
            hx-post="/ui/set_status"
            hx-target="#requestsTable"
            hx-swap="outerHTML"
            hx-on::after-request="htmx.ajax('GET','/ui/partials/priorities',{target:'#prioritiesTable',swap:'outerHTML'})"
          >
            <input type="hidden" name="request_id" value="{{ r.id }}" />
            <select name="status" class="border rounded px-2 py-1 text-sm"
                    hx-trigger="change">
              <option value="PENDIENTE" {{ 'selected' if r.status == 'PENDIENTE' else '' }}>PENDIENTE</option>
              <option value="COMPLETADO" {{ 'selected' if r.status == 'COMPLETADO' else '' }}>COMPLETADO</option>
            </select>
          </form>
        {% endif %}
      </td>
    </tr>
  {% else %}
    <tr><td class="py-2 text-gray-500 px-2" colspan="6">Sin requerimientos</td></tr>
  {% endfor %}
  </tbody>
</table>
